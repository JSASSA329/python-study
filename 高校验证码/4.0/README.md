# 验证码滑块获取器 4.0 使用说明（路径示例以 自己实际的项目目录 代替）

## 项目特点
- 图形界面：基于 PyQt5，操作直观，参数配置便捷。
- 采集模式：支持按间隔采集、按时长采集以及多时间段自动采集。
- 定时控制：可指定开始时间与结束时间；支持多个时间段顺序执行。
- 图片保存：按毫秒时间戳命名，如 `bg_1763400000000.jpg`，避免覆盖。
- 实时日志：展示请求参数、响应数据、匹配与验证结果，便于定位问题。
- 架构清晰：UI 与逻辑分层，参数签名由独立 JS 生成。

## 目录结构
```
4.0/
├─ ui.py             # PyQt5 图形界面：参数输入、线程调度、日志展示
├─ 破解验证码.py      # 一次采集逻辑：获取图片、调用 ddddocr、提交验证
├─ login.js          # 生成 captchaKey/token/iv 等签名参数，依赖 crypto-js
└─ __pycache__/      # Python 编译缓存
```

## 运行环境
- Python：建议 3.10+（64 位）
- Node.js：用于 `execjs` 执行 `login.js`
- Python 包：`PyQt5`、`requests`、`execjs`、`ddddocr`
- Node 包：`crypto-js`

安装示例（在任意目录，路径以 XXX 代替）：
```
pip install PyQt5 requests execjs ddddocr
npm i crypto-js
```

## 架构说明
- UI 层（`ui.py`）：
  - 采集模式：按间隔采集、按时长采集、时间段安排（多段开始/结束）。
  - 参数输入：间隔时间、获取数量、持续时长、开始/结束时间、保存目录。
  - 线程调度：`QThread` 后台执行，避免阻塞 UI；支持停止。
  - 日志：捕获标准输出到日志视图，追加时间戳。
- 逻辑层（`破解验证码.py`）：
  - `fetch_once(js_code, headers)`：
    - 获取验证码图片与 `token`
    - 下载图片、调用 `ddddocr.slide_match` 计算滑动位置
    - 调用验证接口提交匹配结果，输出返回
  - `resolve_login_js()`：读取 `login.js` 内容，供 `execjs` 编译
- 参数签名（`login.js`）：
  - 使用 `crypto-js` 生成 `captchaKey`、`token`、`iv` 等参数
  - 固定 `captchaId` 与 `type`，保持接口兼容

## 使用方法（图形界面）
1. 启动界面：
   - `python "XXX\\4.0\\ui.py"`
2. 设置参数：
   - 间隔时间(秒)：支持小数，必须 > 0
   - 获取数量：仅用于“按间隔采集”模式，表示执行次数
   - 持续时长(秒)：仅用于“按时长采集”模式，表示运行总时长
   - 开始时间：勾选启用，选择未来时间点自动开始；不勾选则立即开始
   - 结束时间：勾选启用，选择结束时间；不勾选则按“持续时长”结束
   - 时间段安排(可选)：点击“添加时间段”，为每行设置开始/结束时间，可添加多段；程序按顺序执行（结束时间必须晚于开始时间）
   - 保存目录：选择图片保存位置（例如 `XXX\\output`）。
3. 开始采集：点击“开始”；日志在下方实时输出，图片保存到选定目录。
4. 停止采集：点击“停止”。

## 使用方法（命令行）
- 直接运行逻辑脚本（无需 UI）：
  - `python "XXX\\4.0\\破解验证码.py" --interval 2`
  - 若未提供 `--interval`，脚本会提示输入秒数并交互运行。

## 日志与输出
- UI 日志：显示每次获取的参数与响应，如 `cx_captcha_function({...})`、滑动匹配结果与验证结果（`result:true/false`）。
- 图片文件：保存到指定目录，以 `bg_<毫秒时间戳>.jpg` 命名，不会覆盖旧文件。

## 常见问题
- 字体警告：`qt.qpa.fonts: Unable to enumerate family ...` 可忽略，不影响运行。
- `crypto-js` 未找到：在项目目录或全局安装 `crypto-js`，确保 Node 环境可用。
- 网络问题：若请求失败或返回异常，请检查网络、接口可用性与防护触发情况。
- 性能与流畅度：日志量较大可能影响 UI 流畅度，建议增大间隔或减少次数。

## 安全与合规
- 本项目用于技术学习与研究，请勿用于违反网站服务条款或法律法规的用途。

## 版本差异提示
- 2.0：命令行定时循环、交互式间隔；图片按时间戳命名。
- 3.0：增加 PyQt5 UI；保存目录可选；说明文档与模块清单。
- 4.0：增强 UI —— 指定开始时间、结束时间与多时间段安排，完善使用说明。

---
如需一键安装脚本，可在此目录或上级目录编写批处理/PowerShell 脚本读取依赖清单后自动安装；路径涉及绝对路径时请用 `XXX` 代替。